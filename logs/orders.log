2025-06-29 23:34:49,028 - INFO - orders - Application starting up - Orders logging initialized
2025-06-29 23:34:49,029 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-06-29 23:36:35,729 - INFO - orders - Application starting up - Orders logging initialized
2025-06-29 23:36:35,729 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-06-29 23:37:13,861 - INFO - orders - Application starting up - Orders logging initialized
2025-06-29 23:37:13,861 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-06-29 23:37:40,132 - INFO - orders - Pending order placement request received - User ID: 10, Symbol: AUDCAD, Type: BUY_LIMIT, Quantity: 0.01
2025-06-29 23:37:40,148 - INFO - orders - Validating pending order price: Order type=BUY_LIMIT, Order price=0.89416, Current buy price=0.8941700000, Current sell price=0.8941100000
2025-06-29 23:37:40,178 - INFO - orders - Calculated contract_value for pending order: 1000.0000000000 (contract_size: 100000.00000000 * quantity: 0.01)
2025-06-29 23:37:40,182 - INFO - orders - [DEBUG] User data from cache: {'id': 10, 'email': 'cursordemo3@gmail.com', 'account_number': 'UPQKI', 'group_name': 'Group B', 'leverage': Decimal('100.00'), 'wallet_balance': Decimal('77.14000000'), 'margin': Decimal('6.55000000'), 'user_type': 'demo', 'first_name': None, 'last_name': None, 'country': None, 'phone_number': Decimal('18618025299')}
2025-06-29 23:37:40,182 - INFO - orders - [DEBUG] Group name: Group B
2025-06-29 23:37:40,183 - INFO - orders - [DEBUG] Group settings from cache: {'sending_orders': 'barclays'}
2025-06-29 23:37:40,183 - INFO - orders - [DEBUG] sending_orders value: barclays, type: <class 'str'>
2025-06-29 23:37:40,183 - INFO - orders - [DEBUG] sending_orders_normalized: barclays
2025-06-29 23:37:40,183 - INFO - orders - User 10 is_barclays_live_user: False (user_type: demo, sending_orders_normalized: barclays)
2025-06-29 23:37:40,199 - INFO - orders - [DEBUG][pending_order] Prepared order_data_for_internal_processing: {'order_id': '2844732039', 'order_company_name': 'AUDCAD', 'order_type': 'BUY_LIMIT', 'order_quantity': Decimal('0.01'), 'order_price': Decimal('0.89416'), 'user_type': 'demo', 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '9034148960', 'takeprofit_id': '6322663779', 'order_user_id': 10, 'order_status': 'PENDING', 'contract_value': Decimal('1000.0000000000'), 'margin': None, 'open_time': None}
2025-06-29 23:37:40,199 - INFO - orders - Placing PENDING order: BUY_LIMIT for user 10 at price 0.89416
2025-06-29 23:37:40,316 - INFO - orders - Order 2844732039 verified in database on attempt 1 before adding to Redis.
2025-06-29 23:37:40,321 - INFO - orders - Pending order 2844732039 added to Redis for non-Barclays user or demo user.
2025-06-29 23:37:40,330 - INFO - orders - User data cache updated for user 10 after placing pending order
2025-06-29 23:37:40,331 - INFO - orders - Starting update_user_static_orders for user 10, user_type demo
2025-06-29 23:37:40,331 - INFO - orders - Using order model: DemoUserOrder
2025-06-29 23:37:40,340 - INFO - orders - Fetched 1 open orders for user 10
2025-06-29 23:37:40,351 - INFO - orders - Fetched 2 pending orders for user 10
2025-06-29 23:37:40,353 - INFO - orders - Updated static orders cache for user 10 with 1 open orders and 2 pending orders
2025-06-29 23:37:44,980 - INFO - orders - [MARGIN_CALC] Starting margin calculation for AUDCAD BUY_LIMIT order, quantity: 0.01000000
2025-06-29 23:37:44,980 - INFO - orders - [MARGIN_CALC] No group_name in settings, fetching for user 10
2025-06-29 23:37:44,985 - INFO - orders - [MARGIN_CALC] Contract size for AUDCAD: 100000.00000000 (raw: 100000.00000000, type: <class 'decimal.Decimal'>)
2025-06-29 23:37:44,987 - INFO - orders - [MARGIN_CALC] Got BUY price for AUDCAD from cache: 0.8941000000
2025-06-29 23:37:44,987 - INFO - orders - [MARGIN_CALC] Contract value calculation for AUDCAD:
2025-06-29 23:37:44,987 - INFO - orders - [MARGIN_CALC] Contract value = contract_size * quantity = 100000.00000000 * 0.01000000 = 1000.0000000000000000
2025-06-29 23:37:44,992 - INFO - orders - [MARGIN_CALC] Using default leverage: 100
2025-06-29 23:37:44,992 - INFO - orders - [MARGIN_CALC] Margin calculation: (contract_value * price) / effective_leverage = (1000.0000000000000000 * 0.8941000000) / 100 = 8.9410000000000000000000000 (rounded to 8.94)
2025-06-29 23:37:44,993 - INFO - orders - [MARGIN_CALC] Commission settings for AUDCAD: type=0, value_type=0, rate=10.0000
2025-06-29 23:37:44,993 - INFO - orders - [MARGIN_CALC] Per lot commission: 0.01000000 * 10.0000 = 0.100000000000
2025-06-29 23:37:44,993 - INFO - orders - [MARGIN_CALC] Profit currency for AUDCAD: CAD
2025-06-29 23:37:44,993 - INFO - orders - [MARGIN_CALC] Converting margin from CAD to USD: 8.94 CAD
2025-06-29 23:37:44,993 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 8.94 CAD to USD for margin for AUDCAD BUY_LIMIT order (user_id: 10, position: )
2025-06-29 23:37:44,993 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-06-29 23:37:44,994 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-06-29 23:37:44,994 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-06-29 23:37:44,994 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-06-29 23:37:44,995 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3656800000'), 'o': Decimal('1.3656400000')}
2025-06-29 23:37:44,995 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3656800000
2025-06-29 23:37:44,995 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 8.94 CAD / 1.3656800000 = 6.546189444086462421650752739 USD
2025-06-29 23:37:44,995 - INFO - orders - [MARGIN_CALC] Margin after USD conversion: 8.94 CAD -> 6.546189444086462421650752739 USD
2025-06-29 23:37:44,995 - INFO - orders - [MARGIN_CALC] Final results for AUDCAD BUY_LIMIT: margin=6.546189444086462421650752739, price=0.8941000000, contract_value=1000.0000000000000000, commission=0.10
