2025-07-03 00:50:23,634 - INFO - orders - Application starting up - Orders logging initialized
2025-07-03 00:50:23,634 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-07-03 00:50:34,800 - app.api.v1.endpoints.orders - INFO - [get_rejected_orders] user_type: live
2025-07-03 00:50:44,553 - INFO - orders - Order close request received - Order ID: 2159920959, User ID: 4, Close Price: 0.5206
2025-07-03 00:50:44,553 - INFO - orders - user_to_operate_on: <app.database.models.User object at 0x000001C125007750>, type: <class 'app.database.models.User'>, user_type: live, attrs: ['__abstract__', '__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__firstlineno__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__mapper__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__static_attributes__', '__str__', '__subclasshook__', '__table__', '__table_args__', '__tablename__', '__weakref__', '_sa_class_manager', '_sa_instance_state', '_sa_registry', 'account_number', 'address_proof', 'address_proof_image', 'bank_account_number', 'bank_branch_name', 'bank_holder_name', 'bank_ifsc_code', 'city', 'country', 'created_at', 'email', 'fund_manager', 'group_name', 'hashed_password', 'id', 'id_proof', 'id_proof_image', 'isActive', 'is_self_trading', 'is_service_account', 'leverage', 'margin', 'metadata', 'money_requests', 'name', 'net_profit', 'orders', 'otps', 'phone_number', 'pincode', 'referred_by_id', 'reffered_code', 'registry', 'rock_orders', 'security_answer', 'security_question', 'state', 'status', 'updated_at', 'user_favorites', 'user_type', 'wallet_balance', 'wallet_transactions']
2025-07-03 00:50:44,553 - INFO - orders - Using order model: user_orders for user 4 (user_type: live)
2025-07-03 00:50:44,554 - INFO - orders - Request to close order 2159920959 for user 4 (user_type: live) with price 0.5206. Frontend provided type: SELL, company: AUDCHF, status: CLOSED, frontend_status: CLOSED.
2025-07-03 00:50:44,561 - INFO - orders - User group: Standard, sending_orders setting: rock
2025-07-03 00:50:44,571 - INFO - orders - Live user 4 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-03 00:50:44,581 - INFO - orders - Existing entry commission for order 2159920959: 0.10000000
2025-07-03 00:50:44,581 - INFO - orders - Commission calculation for order 2159920959: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-03 00:50:44,584 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -0.360000000000000000000000 CHF to USD for PnL on Close (user_id: 4, position: 2159920959)
2025-07-03 00:50:44,585 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CHFUSD
2025-07-03 00:50:44,585 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-03 00:50:44,585 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CHFUSD, trying inverse
2025-07-03 00:50:44,586 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCHF
2025-07-03 00:50:44,586 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('0.7911800000'), 'o': Decimal('0.7911700000')}
2025-07-03 00:50:44,586 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 0.7911800000
2025-07-03 00:50:44,586 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -0.360000000000000000000000 CHF / 0.7911800000 = -0.4550165575469551808690816249 USD
2025-07-03 00:51:22,381 - INFO - orders - Order close request received - Order ID: 2159920959, User ID: 4, Close Price: 0.52057
2025-07-03 00:51:22,381 - INFO - orders - user_to_operate_on: <app.database.models.User object at 0x000001C124FABED0>, type: <class 'app.database.models.User'>, user_type: live, attrs: ['__abstract__', '__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__firstlineno__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__mapper__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__static_attributes__', '__str__', '__subclasshook__', '__table__', '__table_args__', '__tablename__', '__weakref__', '_sa_class_manager', '_sa_instance_state', '_sa_registry', 'account_number', 'address_proof', 'address_proof_image', 'bank_account_number', 'bank_branch_name', 'bank_holder_name', 'bank_ifsc_code', 'city', 'country', 'created_at', 'email', 'fund_manager', 'group_name', 'hashed_password', 'id', 'id_proof', 'id_proof_image', 'isActive', 'is_self_trading', 'is_service_account', 'leverage', 'margin', 'metadata', 'money_requests', 'name', 'net_profit', 'orders', 'otps', 'phone_number', 'pincode', 'referred_by_id', 'reffered_code', 'registry', 'rock_orders', 'security_answer', 'security_question', 'state', 'status', 'updated_at', 'user_favorites', 'user_type', 'wallet_balance', 'wallet_transactions']
2025-07-03 00:51:22,381 - INFO - orders - Using order model: user_orders for user 4 (user_type: live)
2025-07-03 00:51:22,382 - INFO - orders - Request to close order 2159920959 for user 4 (user_type: live) with price 0.52057. Frontend provided type: SELL, company: AUDCHF, status: CLOSED, frontend_status: CLOSED.
2025-07-03 00:51:22,386 - INFO - orders - User group: Standard, sending_orders setting: rock
2025-07-03 00:51:22,394 - INFO - orders - Live user 4 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-03 00:51:22,404 - INFO - orders - Existing entry commission for order 2159920959: 0.10000000
2025-07-03 00:51:22,404 - INFO - orders - Commission calculation for order 2159920959: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-03 00:51:22,407 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -0.330000000000000000000000 CHF to USD for PnL on Close (user_id: 4, position: 2159920959)
2025-07-03 00:51:22,407 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CHFUSD
2025-07-03 00:51:22,408 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-03 00:51:22,408 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CHFUSD, trying inverse
2025-07-03 00:51:22,409 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCHF
2025-07-03 00:51:22,410 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('0.7910900000'), 'o': Decimal('0.7910600000')}
2025-07-03 00:51:22,410 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 0.7910900000
2025-07-03 00:51:22,410 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -0.330000000000000000000000 CHF / 0.7910900000 = -0.4171459631647473738765500765 USD
2025-07-03 00:53:01,624 - INFO - orders - Order close request received - Order ID: 2159920959, User ID: 4, Close Price: 0.52044
2025-07-03 00:53:01,625 - INFO - orders - user_to_operate_on: <app.database.models.User object at 0x000001C124FABED0>, type: <class 'app.database.models.User'>, user_type: live, attrs: ['__abstract__', '__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__firstlineno__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__mapper__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__static_attributes__', '__str__', '__subclasshook__', '__table__', '__table_args__', '__tablename__', '__weakref__', '_sa_class_manager', '_sa_instance_state', '_sa_registry', 'account_number', 'address_proof', 'address_proof_image', 'bank_account_number', 'bank_branch_name', 'bank_holder_name', 'bank_ifsc_code', 'city', 'country', 'created_at', 'email', 'fund_manager', 'group_name', 'hashed_password', 'id', 'id_proof', 'id_proof_image', 'isActive', 'is_self_trading', 'is_service_account', 'leverage', 'margin', 'metadata', 'money_requests', 'name', 'net_profit', 'orders', 'otps', 'phone_number', 'pincode', 'referred_by_id', 'reffered_code', 'registry', 'rock_orders', 'security_answer', 'security_question', 'state', 'status', 'updated_at', 'user_favorites', 'user_type', 'wallet_balance', 'wallet_transactions']
2025-07-03 00:53:01,625 - INFO - orders - Using order model: user_orders for user 4 (user_type: live)
2025-07-03 00:53:01,626 - INFO - orders - Request to close order 2159920959 for user 4 (user_type: live) with price 0.52044. Frontend provided type: SELL, company: AUDCHF, status: CLOSED, frontend_status: CLOSED.
2025-07-03 00:53:01,631 - INFO - orders - User group: Standard, sending_orders setting: rock
2025-07-03 00:53:01,644 - INFO - orders - Live user 4 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-03 00:53:01,655 - INFO - orders - Existing entry commission for order 2159920959: 0.10000000
2025-07-03 00:53:01,655 - INFO - orders - Commission calculation for order 2159920959: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-03 00:53:01,660 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -0.200000000000000000000000 CHF to USD for PnL on Close (user_id: 4, position: 2159920959)
2025-07-03 00:53:01,660 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CHFUSD
2025-07-03 00:53:01,661 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-03 00:53:01,662 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CHFUSD, trying inverse
2025-07-03 00:53:01,662 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCHF
2025-07-03 00:53:01,663 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('0.7910500000'), 'o': Decimal('0.7910100000')}
2025-07-03 00:53:01,663 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 0.7910500000
2025-07-03 00:53:01,664 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -0.200000000000000000000000 CHF / 0.7910500000 = -0.2528285190569496239175779028 USD
2025-07-03 00:53:05,322 - app.api.v1.endpoints.orders - INFO - [get_rejected_orders] user_type: live
2025-07-03 01:02:52,954 - INFO - orders - Application starting up - Orders logging initialized
2025-07-03 01:02:52,955 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-07-03 01:03:12,491 - app.api.v1.endpoints.orders - INFO - [get_rejected_orders] user_type: live
2025-07-03 01:03:24,035 - INFO - orders - Order close request received - Order ID: 2159920959, User ID: 4, Close Price: 0.52075
2025-07-03 01:03:24,037 - INFO - orders - user_to_operate_on: <app.database.models.User object at 0x0000014C19315310>, type: <class 'app.database.models.User'>, user_type: live, attrs: ['__abstract__', '__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__firstlineno__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__mapper__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__static_attributes__', '__str__', '__subclasshook__', '__table__', '__table_args__', '__tablename__', '__weakref__', '_sa_class_manager', '_sa_instance_state', '_sa_registry', 'account_number', 'address_proof', 'address_proof_image', 'bank_account_number', 'bank_branch_name', 'bank_holder_name', 'bank_ifsc_code', 'city', 'country', 'created_at', 'email', 'fund_manager', 'group_name', 'hashed_password', 'id', 'id_proof', 'id_proof_image', 'isActive', 'is_self_trading', 'is_service_account', 'leverage', 'margin', 'metadata', 'money_requests', 'name', 'net_profit', 'orders', 'otps', 'phone_number', 'pincode', 'referred_by_id', 'reffered_code', 'registry', 'rock_orders', 'security_answer', 'security_question', 'state', 'status', 'updated_at', 'user_favorites', 'user_type', 'wallet_balance', 'wallet_transactions']
2025-07-03 01:03:24,037 - INFO - orders - Using order model: user_orders for user 4 (user_type: live)
2025-07-03 01:03:24,038 - INFO - orders - Request to close order 2159920959 for user 4 (user_type: live) with price 0.52075. Frontend provided type: SELL, company: AUDCHF, status: CLOSED, frontend_status: CLOSED.
2025-07-03 01:03:24,049 - INFO - orders - User group: Standard, sending_orders setting: rock
2025-07-03 01:03:24,061 - INFO - orders - Live user 4 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-03 01:03:24,075 - INFO - orders - Existing entry commission for order 2159920959: 0.10000000
2025-07-03 01:03:24,075 - INFO - orders - Commission calculation for order 2159920959: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-03 01:03:24,080 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -0.510000000000000000000000 CHF to USD for PnL on Close (user_id: 4, position: 2159920959)
2025-07-03 01:03:24,081 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CHFUSD
2025-07-03 01:03:24,081 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-03 01:03:24,081 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CHFUSD, trying inverse
2025-07-03 01:03:24,081 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCHF
2025-07-03 01:03:24,082 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('0.7913400000'), 'o': Decimal('0.7913000000')}
2025-07-03 01:03:24,082 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 0.7913400000
2025-07-03 01:03:24,083 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -0.510000000000000000000000 CHF / 0.7913400000 = -0.6444764576541056941390552733 USD
2025-07-03 01:03:43,272 - INFO - orders - Order close request received - Order ID: 2159920959, User ID: 4, Close Price: 0.52076
2025-07-03 01:03:43,285 - INFO - orders - user_to_operate_on: <app.database.models.User object at 0x0000014C193B2490>, type: <class 'app.database.models.User'>, user_type: live, attrs: ['__abstract__', '__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__firstlineno__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__mapper__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__static_attributes__', '__str__', '__subclasshook__', '__table__', '__table_args__', '__tablename__', '__weakref__', '_sa_class_manager', '_sa_instance_state', '_sa_registry', 'account_number', 'address_proof', 'address_proof_image', 'bank_account_number', 'bank_branch_name', 'bank_holder_name', 'bank_ifsc_code', 'city', 'country', 'created_at', 'email', 'fund_manager', 'group_name', 'hashed_password', 'id', 'id_proof', 'id_proof_image', 'isActive', 'is_self_trading', 'is_service_account', 'leverage', 'margin', 'metadata', 'money_requests', 'name', 'net_profit', 'orders', 'otps', 'phone_number', 'pincode', 'referred_by_id', 'reffered_code', 'registry', 'rock_orders', 'security_answer', 'security_question', 'state', 'status', 'updated_at', 'user_favorites', 'user_type', 'wallet_balance', 'wallet_transactions']
2025-07-03 01:03:43,285 - INFO - orders - Using order model: user_orders for user 4 (user_type: live)
2025-07-03 01:03:43,285 - INFO - orders - Request to close order 2159920959 for user 4 (user_type: live) with price 0.52076. Frontend provided type: SELL, company: AUDCHF, status: CLOSED, frontend_status: CLOSED.
2025-07-03 01:03:43,396 - INFO - orders - User group: Standard, sending_orders setting: rock
2025-07-03 01:03:43,491 - INFO - orders - Live user 4 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-03 01:03:43,679 - INFO - orders - Existing entry commission for order 2159920959: 0.10000000
2025-07-03 01:03:43,679 - INFO - orders - Commission calculation for order 2159920959: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-03 01:03:43,682 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -0.520000000000000000000000 CHF to USD for PnL on Close (user_id: 4, position: 2159920959)
2025-07-03 01:03:43,683 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CHFUSD
2025-07-03 01:03:43,687 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-03 01:03:43,687 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CHFUSD, trying inverse
2025-07-03 01:03:43,687 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCHF
2025-07-03 01:03:43,690 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('0.7913400000'), 'o': Decimal('0.7913000000')}
2025-07-03 01:03:43,690 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 0.7913400000
2025-07-03 01:03:43,690 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -0.520000000000000000000000 CHF / 0.7913400000 = -0.6571132509414410999064877297 USD
2025-07-03 01:03:44,255 - INFO - orders - Order close request received - Order ID: 8860284337, User ID: 4, Close Price: 0.5205
2025-07-03 01:03:44,255 - INFO - orders - user_to_operate_on: <app.database.models.User object at 0x0000014C19317110>, type: <class 'app.database.models.User'>, user_type: live, attrs: ['__abstract__', '__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__firstlineno__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__mapper__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__static_attributes__', '__str__', '__subclasshook__', '__table__', '__table_args__', '__tablename__', '__weakref__', '_sa_class_manager', '_sa_instance_state', '_sa_registry', 'account_number', 'address_proof', 'address_proof_image', 'bank_account_number', 'bank_branch_name', 'bank_holder_name', 'bank_ifsc_code', 'city', 'country', 'created_at', 'email', 'fund_manager', 'group_name', 'hashed_password', 'id', 'id_proof', 'id_proof_image', 'isActive', 'is_self_trading', 'is_service_account', 'leverage', 'margin', 'metadata', 'money_requests', 'name', 'net_profit', 'orders', 'otps', 'phone_number', 'pincode', 'referred_by_id', 'reffered_code', 'registry', 'rock_orders', 'security_answer', 'security_question', 'state', 'status', 'updated_at', 'user_favorites', 'user_type', 'wallet_balance', 'wallet_transactions']
2025-07-03 01:03:44,255 - INFO - orders - Using order model: user_orders for user 4 (user_type: live)
2025-07-03 01:03:44,255 - INFO - orders - Request to close order 8860284337 for user 4 (user_type: live) with price 0.5205. Frontend provided type: BUY, company: AUDCHF, status: CLOSED, frontend_status: CLOSED.
2025-07-03 01:03:44,259 - INFO - orders - User group: Standard, sending_orders setting: rock
2025-07-03 01:03:44,267 - INFO - orders - Live user 4 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-03 01:03:44,276 - INFO - orders - Existing entry commission for order 8860284337: 0.10000000
2025-07-03 01:03:44,276 - INFO - orders - Commission calculation for order 8860284337: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-03 01:03:44,279 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 0.300000000000000000000000 CHF to USD for PnL on Close (user_id: 4, position: 8860284337)
2025-07-03 01:03:44,279 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CHFUSD
2025-07-03 01:03:44,280 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-03 01:03:44,280 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CHFUSD, trying inverse
2025-07-03 01:03:44,280 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCHF
2025-07-03 01:03:44,281 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('0.7913500000'), 'o': Decimal('0.7913200000')}
2025-07-03 01:03:44,281 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 0.7913500000
2025-07-03 01:03:44,281 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 0.300000000000000000000000 CHF / 0.7913500000 = 0.3790990080242623365135527895 USD
2025-07-03 01:03:44,825 - INFO - orders - Order close request received - Order ID: 3606799839, User ID: 4, Close Price: 94.633
2025-07-03 01:03:44,825 - INFO - orders - user_to_operate_on: <app.database.models.User object at 0x0000014C19317110>, type: <class 'app.database.models.User'>, user_type: live, attrs: ['__abstract__', '__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__firstlineno__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__mapper__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__static_attributes__', '__str__', '__subclasshook__', '__table__', '__table_args__', '__tablename__', '__weakref__', '_sa_class_manager', '_sa_instance_state', '_sa_registry', 'account_number', 'address_proof', 'address_proof_image', 'bank_account_number', 'bank_branch_name', 'bank_holder_name', 'bank_ifsc_code', 'city', 'country', 'created_at', 'email', 'fund_manager', 'group_name', 'hashed_password', 'id', 'id_proof', 'id_proof_image', 'isActive', 'is_self_trading', 'is_service_account', 'leverage', 'margin', 'metadata', 'money_requests', 'name', 'net_profit', 'orders', 'otps', 'phone_number', 'pincode', 'referred_by_id', 'reffered_code', 'registry', 'rock_orders', 'security_answer', 'security_question', 'state', 'status', 'updated_at', 'user_favorites', 'user_type', 'wallet_balance', 'wallet_transactions']
2025-07-03 01:03:44,825 - INFO - orders - Using order model: user_orders for user 4 (user_type: live)
2025-07-03 01:03:44,825 - INFO - orders - Request to close order 3606799839 for user 4 (user_type: live) with price 94.633. Frontend provided type: BUY, company: AUDJPY, status: CLOSED, frontend_status: CLOSED.
2025-07-03 01:03:44,829 - INFO - orders - User group: Standard, sending_orders setting: rock
2025-07-03 01:03:44,838 - INFO - orders - Live user 4 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-03 01:03:44,847 - INFO - orders - Existing entry commission for order 3606799839: 0.10000000
2025-07-03 01:03:44,847 - INFO - orders - Commission calculation for order 3606799839: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-03 01:03:44,850 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 428.000000000000000000000000 JPY to USD for PnL on Close (user_id: 4, position: 3606799839)
2025-07-03 01:03:44,850 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-03 01:03:44,851 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-03 01:03:44,851 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-03 01:03:44,851 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-03 01:03:44,852 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('143.8620000000'), 'o': Decimal('143.8600000000')}
2025-07-03 01:03:44,852 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 143.8620000000
2025-07-03 01:03:44,852 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 428.000000000000000000000000 JPY / 143.8620000000 = 2.975073334167466043847576149 USD
2025-07-03 01:03:45,416 - INFO - orders - Order close request received - Order ID: 4421668921, User ID: 4, Close Price: 0.89405
2025-07-03 01:03:45,416 - INFO - orders - user_to_operate_on: <app.database.models.User object at 0x0000014C19317750>, type: <class 'app.database.models.User'>, user_type: live, attrs: ['__abstract__', '__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__firstlineno__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__mapper__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__static_attributes__', '__str__', '__subclasshook__', '__table__', '__table_args__', '__tablename__', '__weakref__', '_sa_class_manager', '_sa_instance_state', '_sa_registry', 'account_number', 'address_proof', 'address_proof_image', 'bank_account_number', 'bank_branch_name', 'bank_holder_name', 'bank_ifsc_code', 'city', 'country', 'created_at', 'email', 'fund_manager', 'group_name', 'hashed_password', 'id', 'id_proof', 'id_proof_image', 'isActive', 'is_self_trading', 'is_service_account', 'leverage', 'margin', 'metadata', 'money_requests', 'name', 'net_profit', 'orders', 'otps', 'phone_number', 'pincode', 'referred_by_id', 'reffered_code', 'registry', 'rock_orders', 'security_answer', 'security_question', 'state', 'status', 'updated_at', 'user_favorites', 'user_type', 'wallet_balance', 'wallet_transactions']
2025-07-03 01:03:45,416 - INFO - orders - Using order model: user_orders for user 4 (user_type: live)
2025-07-03 01:03:45,417 - INFO - orders - Request to close order 4421668921 for user 4 (user_type: live) with price 0.89405. Frontend provided type: BUY, company: AUDCAD, status: CLOSED, frontend_status: CLOSED.
2025-07-03 01:03:45,454 - INFO - orders - User group: Standard, sending_orders setting: rock
2025-07-03 01:03:45,463 - INFO - orders - Live user 4 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-03 01:03:45,476 - INFO - orders - Existing entry commission for order 4421668921: 0.10000000
2025-07-03 01:03:45,476 - INFO - orders - Commission calculation for order 4421668921: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-03 01:03:45,480 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -1.480000000000000000000000 CAD to USD for PnL on Close (user_id: 4, position: 4421668921)
2025-07-03 01:03:45,480 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-07-03 01:03:45,482 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-03 01:03:45,483 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-07-03 01:03:45,483 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-07-03 01:03:45,485 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3591200000'), 'o': Decimal('1.3590700000')}
2025-07-03 01:03:45,485 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3591200000
2025-07-03 01:03:45,485 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -1.480000000000000000000000 CAD / 1.3591200000 = -1.088939902289716875625404674 USD
2025-07-03 01:03:46,366 - INFO - orders - Order close request received - Order ID: 4663450540, User ID: 4, Close Price: 0.89402
2025-07-03 01:03:46,366 - INFO - orders - user_to_operate_on: <app.database.models.User object at 0x0000014C19317110>, type: <class 'app.database.models.User'>, user_type: live, attrs: ['__abstract__', '__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__firstlineno__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__mapper__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__static_attributes__', '__str__', '__subclasshook__', '__table__', '__table_args__', '__tablename__', '__weakref__', '_sa_class_manager', '_sa_instance_state', '_sa_registry', 'account_number', 'address_proof', 'address_proof_image', 'bank_account_number', 'bank_branch_name', 'bank_holder_name', 'bank_ifsc_code', 'city', 'country', 'created_at', 'email', 'fund_manager', 'group_name', 'hashed_password', 'id', 'id_proof', 'id_proof_image', 'isActive', 'is_self_trading', 'is_service_account', 'leverage', 'margin', 'metadata', 'money_requests', 'name', 'net_profit', 'orders', 'otps', 'phone_number', 'pincode', 'referred_by_id', 'reffered_code', 'registry', 'rock_orders', 'security_answer', 'security_question', 'state', 'status', 'updated_at', 'user_favorites', 'user_type', 'wallet_balance', 'wallet_transactions']
2025-07-03 01:03:46,366 - INFO - orders - Using order model: user_orders for user 4 (user_type: live)
2025-07-03 01:03:46,366 - INFO - orders - Request to close order 4663450540 for user 4 (user_type: live) with price 0.89402. Frontend provided type: BUY, company: AUDCAD, status: CLOSED, frontend_status: CLOSED.
2025-07-03 01:03:46,370 - INFO - orders - User group: Standard, sending_orders setting: rock
2025-07-03 01:03:46,379 - INFO - orders - Live user 4 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-03 01:03:46,390 - INFO - orders - Existing entry commission for order 4663450540: 0.0
2025-07-03 01:03:46,390 - INFO - orders - Commission calculation for order 4663450540: entry=0.0, exit=0.100000000000, total=0.10
2025-07-03 01:03:46,393 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -1.550000000000000000000000 CAD to USD for PnL on Close (user_id: 4, position: 4663450540)
2025-07-03 01:03:46,394 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-07-03 01:03:46,395 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-03 01:03:46,395 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-07-03 01:03:46,395 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-07-03 01:03:46,397 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3591200000'), 'o': Decimal('1.3590700000')}
2025-07-03 01:03:46,398 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3591200000
2025-07-03 01:03:46,398 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -1.550000000000000000000000 CAD / 1.3591200000 = -1.140443816587203484607687327 USD
2025-07-03 01:11:45,262 - INFO - orders - Application starting up - Orders logging initialized
2025-07-03 01:11:45,262 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-07-03 01:12:08,546 - app.api.v1.endpoints.orders - INFO - [get_rejected_orders] user_type: live
2025-07-03 01:12:13,237 - INFO - orders - Order placement request received - User ID: 4, Symbol: AUDCHF, Type: BUY, Quantity: 0.01
2025-07-03 01:12:13,239 - INFO - orders - [PERF] user_data_cache: 0.0019s
2025-07-03 01:12:13,242 - INFO - orders - [PERF] group_settings_cache+db_user: 0.0030s
2025-07-03 01:12:13,242 - DEBUG - orders - [BARCLAYS DETECTION] user_type=live, sending_orders_normalized=rock, is_barclays_live_user=False
2025-07-03 01:12:13,572 - INFO - orders - [MARGIN_CALC] Starting margin calculation for AUDCHF BUY order, quantity: 0.01
2025-07-03 01:12:13,572 - INFO - orders - [MARGIN_CALC] No group_name in settings, fetching for user 4
2025-07-03 01:12:13,578 - INFO - orders - [MARGIN_CALC] Got group_name from database: Standard
2025-07-03 01:12:13,578 - INFO - orders - [MARGIN_CALC] Contract size for AUDCHF: 100000.00000000 (raw: 100000.00000000, type: <class 'decimal.Decimal'>)
2025-07-03 01:12:13,579 - INFO - orders - [MARGIN_CALC] Got BUY price for AUDCHF from cache: 0.5207100000
2025-07-03 01:12:13,579 - INFO - orders - [MARGIN_CALC] Symbol type from group settings: 1
2025-07-03 01:12:13,579 - INFO - orders - [MARGIN_CALC] Standard contract value calculation: contract_size * quantity = 100000.00000000 * 0.01 = 1000.0000000000
2025-07-03 01:12:13,579 - INFO - orders - [MARGIN_CALC] Standard Margin calc: (contract_value * price) / effective_leverage = (1000.0000000000 * 0.5207100000) / 100.00 = 5.207100000000000000
2025-07-03 01:12:13,580 - INFO - orders - [MARGIN_CALC] Commission settings for AUDCHF: type=0, value_type=0, rate=10.0000
2025-07-03 01:12:13,580 - INFO - orders - [MARGIN_CALC] Per lot commission: 0.01 * 10.0000 = 0.100000
2025-07-03 01:12:13,580 - INFO - orders - [MARGIN_CALC] Profit currency for AUDCHF: CHF
2025-07-03 01:12:13,580 - INFO - orders - [MARGIN_CALC] Converting margin from CHF to USD: 5.21 CHF
2025-07-03 01:12:13,580 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 5.21 CHF to USD for margin for AUDCHF BUY order (user_id: 4, position: )
2025-07-03 01:12:13,580 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CHFUSD
2025-07-03 01:12:13,581 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-03 01:12:13,581 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CHFUSD, trying inverse
2025-07-03 01:12:13,581 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCHF
2025-07-03 01:12:13,582 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('0.7912600000'), 'o': Decimal('0.7912100000')}
2025-07-03 01:12:13,582 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 0.7912600000
2025-07-03 01:12:13,582 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 5.21 CHF / 0.7912600000 = 6.584434951848949776306144630 USD
2025-07-03 01:12:13,582 - INFO - orders - [MARGIN_CALC] Margin after USD conversion: 5.21 CHF -> 6.584434951848949776306144630 USD
2025-07-03 01:12:13,582 - INFO - orders - [MARGIN_CALC] Final results for AUDCHF BUY: margin=6.584434951848949776306144630, price=0.5207100000, contract_value=1000.0000000000, commission=0.10
2025-07-03 01:12:13,582 - app.services.order_processing - INFO - [COMMISSION_CALC] User 4 Symbol AUDCHF: Calculated commission=0.10
2025-07-03 01:12:13,588 - app.services.order_processing - INFO - [MARGIN_PROCESS] User 4 Symbol AUDCHF: MarginBefore=0.00, MarginAfter=6.58, AdditionalMargin=6.58
2025-07-03 01:12:13,588 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] User 4 Symbol AUDCHF
2025-07-03 01:12:13,588 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] Full margin for this order: 6.584434951848949776306144630
2025-07-03 01:12:13,589 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] Existing open orders count: 0
2025-07-03 01:12:13,589 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] Total margin before: 0.0
2025-07-03 01:12:13,589 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] Total margin after: 6.58
2025-07-03 01:12:13,589 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] Additional margin needed: 6.58
2025-07-03 01:12:13,595 - app.services.order_processing - INFO - [MARGIN_PROCESS] User 4: OriginalMarginDB=26.33000000, CalculatedNewMargin=32.91
2025-07-03 01:12:13,619 - INFO - orders - [PERF] process_new_order: 0.3766s
2025-07-03 01:12:13,619 - INFO - orders - [ENTER-CRUD] create_order called with: {'order_id': '3358075758', 'order_status': 'OPEN', 'order_user_id': 4, 'order_company_name': 'AUDCHF', 'order_type': 'BUY', 'order_price': Decimal('0.5207100000'), 'order_quantity': Decimal('0.01'), 'contract_value': Decimal('1000.0000000000'), 'margin': Decimal('6.584434951848949776306144630'), 'commission': Decimal('0.10'), 'stop_loss': None, 'take_profit': None, 'stoploss_id': None, 'takeprofit_id': None, 'status': 'OPEN'}
2025-07-03 01:12:13,619 - DEBUG - orders - [DEBUG][create_order] Received order_data: {'order_id': '3358075758', 'order_status': 'OPEN', 'order_user_id': 4, 'order_company_name': 'AUDCHF', 'order_type': 'BUY', 'order_price': Decimal('0.5207100000'), 'order_quantity': Decimal('0.01'), 'contract_value': Decimal('1000.0000000000'), 'margin': Decimal('6.584434951848949776306144630'), 'commission': Decimal('0.10'), 'stop_loss': None, 'take_profit': None, 'stoploss_id': None, 'takeprofit_id': None, 'status': 'OPEN'}
2025-07-03 01:12:13,619 - DEBUG - orders - [DEBUG][create_order] Created OrderActionHistory record for order_id: 3358075758
2025-07-03 01:12:13,643 - INFO - orders - [PERF] crud_order.create_order: 0.0244s
2025-07-03 01:12:13,652 - INFO - orders - [PERF] db.commit+refresh: 0.0081s
2025-07-03 01:12:13,652 - INFO - orders - [PERF] TOTAL place_order: 0.4170s
2025-07-03 01:12:13,670 - app.api.v1.endpoints.orders - INFO - User 4: Updated static orders cache after order change - 1 open orders, 0 pending orders
2025-07-03 01:12:22,046 - INFO - orders - Order close request received - Order ID: 3358075758, User ID: 4, Close Price: 0.52045
2025-07-03 01:12:22,047 - INFO - orders - user_to_operate_on: <app.database.models.User object at 0x000001D04B2A5A90>, type: <class 'app.database.models.User'>, user_type: live, attrs: ['__abstract__', '__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__firstlineno__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__mapper__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__static_attributes__', '__str__', '__subclasshook__', '__table__', '__table_args__', '__tablename__', '__weakref__', '_sa_class_manager', '_sa_instance_state', '_sa_registry', 'account_number', 'address_proof', 'address_proof_image', 'bank_account_number', 'bank_branch_name', 'bank_holder_name', 'bank_ifsc_code', 'city', 'country', 'created_at', 'email', 'fund_manager', 'group_name', 'hashed_password', 'id', 'id_proof', 'id_proof_image', 'isActive', 'is_self_trading', 'is_service_account', 'leverage', 'margin', 'metadata', 'money_requests', 'name', 'net_profit', 'orders', 'otps', 'phone_number', 'pincode', 'referred_by_id', 'reffered_code', 'registry', 'rock_orders', 'security_answer', 'security_question', 'state', 'status', 'updated_at', 'user_favorites', 'user_type', 'wallet_balance', 'wallet_transactions']
2025-07-03 01:12:22,047 - INFO - orders - Using order model: user_orders for user 4 (user_type: live)
2025-07-03 01:12:22,047 - INFO - orders - Request to close order 3358075758 for user 4 (user_type: live) with price 0.52045. Frontend provided type: BUY, company: AUDCHF, status: CLOSED, frontend_status: CLOSED.
2025-07-03 01:12:22,051 - INFO - orders - User group: Standard, sending_orders setting: rock
2025-07-03 01:12:22,058 - INFO - orders - Live user 4 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-03 01:12:22,066 - INFO - orders - Existing entry commission for order 3358075758: 0.10000000
2025-07-03 01:12:22,066 - INFO - orders - Commission calculation for order 3358075758: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-03 01:12:22,069 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -0.260000000000000000000000 CHF to USD for PnL on Close (user_id: 4, position: 3358075758)
2025-07-03 01:12:22,069 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CHFUSD
2025-07-03 01:12:22,069 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-03 01:12:22,069 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CHFUSD, trying inverse
2025-07-03 01:12:22,069 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCHF
2025-07-03 01:12:22,070 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('0.7912000000'), 'o': Decimal('0.7911600000')}
2025-07-03 01:12:22,070 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 0.7912000000
2025-07-03 01:12:22,070 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -0.260000000000000000000000 CHF / 0.7912000000 = -0.3286147623862487360970677452 USD
2025-07-03 01:12:42,789 - INFO - orders - Order placement request received - User ID: 4, Symbol: AUDCHF, Type: SELL, Quantity: 0.01
2025-07-03 01:12:42,791 - INFO - orders - [PERF] user_data_cache: 0.0015s
2025-07-03 01:12:42,792 - INFO - orders - [PERF] group_settings_cache+db_user: 0.0009s
2025-07-03 01:12:42,792 - DEBUG - orders - [BARCLAYS DETECTION] user_type=live, sending_orders_normalized=rock, is_barclays_live_user=False
2025-07-03 01:12:43,149 - INFO - orders - [MARGIN_CALC] Starting margin calculation for AUDCHF SELL order, quantity: 0.01
2025-07-03 01:12:43,150 - INFO - orders - [MARGIN_CALC] No group_name in settings, fetching for user 4
2025-07-03 01:12:43,153 - INFO - orders - [MARGIN_CALC] Got group_name from database: Standard
2025-07-03 01:12:43,153 - INFO - orders - [MARGIN_CALC] Contract size for AUDCHF: 100000.00000000 (raw: 100000.00000000, type: <class 'decimal.Decimal'>)
2025-07-03 01:12:43,153 - INFO - orders - [MARGIN_CALC] Got SELL price for AUDCHF from cache: 0.5204800000
2025-07-03 01:12:43,153 - INFO - orders - [MARGIN_CALC] Symbol type from group settings: 1
2025-07-03 01:12:43,153 - INFO - orders - [MARGIN_CALC] Standard contract value calculation: contract_size * quantity = 100000.00000000 * 0.01 = 1000.0000000000
2025-07-03 01:12:43,153 - INFO - orders - [MARGIN_CALC] Standard Margin calc: (contract_value * price) / effective_leverage = (1000.0000000000 * 0.5204800000) / 100.00 = 5.204800000000000000
2025-07-03 01:12:43,153 - INFO - orders - [MARGIN_CALC] Commission settings for AUDCHF: type=0, value_type=0, rate=10.0000
2025-07-03 01:12:43,153 - INFO - orders - [MARGIN_CALC] Per lot commission: 0.01 * 10.0000 = 0.100000
2025-07-03 01:12:43,153 - INFO - orders - [MARGIN_CALC] Profit currency for AUDCHF: CHF
2025-07-03 01:12:43,153 - INFO - orders - [MARGIN_CALC] Converting margin from CHF to USD: 5.20 CHF
2025-07-03 01:12:43,154 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 5.20 CHF to USD for margin for AUDCHF SELL order (user_id: 4, position: )
2025-07-03 01:12:43,154 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CHFUSD
2025-07-03 01:12:43,154 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-03 01:12:43,154 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CHFUSD, trying inverse
2025-07-03 01:12:43,154 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCHF
2025-07-03 01:12:43,155 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('0.7912000000'), 'o': Decimal('0.7911600000')}
2025-07-03 01:12:43,155 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 0.7912000000
2025-07-03 01:12:43,155 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 5.20 CHF / 0.7912000000 = 6.572295247724974721941354904 USD
2025-07-03 01:12:43,155 - INFO - orders - [MARGIN_CALC] Margin after USD conversion: 5.20 CHF -> 6.572295247724974721941354904 USD
2025-07-03 01:12:43,155 - INFO - orders - [MARGIN_CALC] Final results for AUDCHF SELL: margin=6.572295247724974721941354904, price=0.5204800000, contract_value=1000.0000000000, commission=0.10
2025-07-03 01:12:43,155 - app.services.order_processing - INFO - [COMMISSION_CALC] User 4 Symbol AUDCHF: Calculated commission=0.10
2025-07-03 01:12:43,158 - app.services.order_processing - INFO - [MARGIN_PROCESS] User 4 Symbol AUDCHF: MarginBefore=0.00, MarginAfter=6.57, AdditionalMargin=6.57
2025-07-03 01:12:43,159 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] User 4 Symbol AUDCHF
2025-07-03 01:12:43,159 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] Full margin for this order: 6.572295247724974721941354904
2025-07-03 01:12:43,159 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] Existing open orders count: 0
2025-07-03 01:12:43,159 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] Total margin before: 0.0
2025-07-03 01:12:43,159 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] Total margin after: 6.57
2025-07-03 01:12:43,159 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] Additional margin needed: 6.57
2025-07-03 01:12:43,160 - app.services.order_processing - INFO - [MARGIN_PROCESS] User 4: OriginalMarginDB=32.91000000, CalculatedNewMargin=39.48
2025-07-03 01:12:43,173 - INFO - orders - [PERF] process_new_order: 0.3812s
2025-07-03 01:12:43,173 - INFO - orders - [ENTER-CRUD] create_order called with: {'order_id': '7867765085', 'order_status': 'OPEN', 'order_user_id': 4, 'order_company_name': 'AUDCHF', 'order_type': 'SELL', 'order_price': Decimal('0.5204800000'), 'order_quantity': Decimal('0.01'), 'contract_value': Decimal('1000.0000000000'), 'margin': Decimal('6.572295247724974721941354904'), 'commission': Decimal('0.10'), 'stop_loss': None, 'take_profit': None, 'stoploss_id': None, 'takeprofit_id': None, 'status': 'OPEN'}
2025-07-03 01:12:43,173 - DEBUG - orders - [DEBUG][create_order] Received order_data: {'order_id': '7867765085', 'order_status': 'OPEN', 'order_user_id': 4, 'order_company_name': 'AUDCHF', 'order_type': 'SELL', 'order_price': Decimal('0.5204800000'), 'order_quantity': Decimal('0.01'), 'contract_value': Decimal('1000.0000000000'), 'margin': Decimal('6.572295247724974721941354904'), 'commission': Decimal('0.10'), 'stop_loss': None, 'take_profit': None, 'stoploss_id': None, 'takeprofit_id': None, 'status': 'OPEN'}
2025-07-03 01:12:43,173 - DEBUG - orders - [DEBUG][create_order] Created OrderActionHistory record for order_id: 7867765085
2025-07-03 01:12:43,185 - INFO - orders - [PERF] crud_order.create_order: 0.0115s
2025-07-03 01:12:43,187 - INFO - orders - [PERF] db.commit+refresh: 0.0023s
2025-07-03 01:12:43,187 - INFO - orders - [PERF] TOTAL place_order: 0.3982s
2025-07-03 01:12:43,196 - app.api.v1.endpoints.orders - INFO - User 4: Updated static orders cache after order change - 1 open orders, 0 pending orders
2025-07-03 01:12:49,006 - INFO - orders - Order close request received - Order ID: 7867765085, User ID: 4, Close Price: 0.52078
2025-07-03 01:12:49,006 - INFO - orders - user_to_operate_on: <app.database.models.User object at 0x000001D04B2A5A90>, type: <class 'app.database.models.User'>, user_type: live, attrs: ['__abstract__', '__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__firstlineno__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__mapper__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__static_attributes__', '__str__', '__subclasshook__', '__table__', '__table_args__', '__tablename__', '__weakref__', '_sa_class_manager', '_sa_instance_state', '_sa_registry', 'account_number', 'address_proof', 'address_proof_image', 'bank_account_number', 'bank_branch_name', 'bank_holder_name', 'bank_ifsc_code', 'city', 'country', 'created_at', 'email', 'fund_manager', 'group_name', 'hashed_password', 'id', 'id_proof', 'id_proof_image', 'isActive', 'is_self_trading', 'is_service_account', 'leverage', 'margin', 'metadata', 'money_requests', 'name', 'net_profit', 'orders', 'otps', 'phone_number', 'pincode', 'referred_by_id', 'reffered_code', 'registry', 'rock_orders', 'security_answer', 'security_question', 'state', 'status', 'updated_at', 'user_favorites', 'user_type', 'wallet_balance', 'wallet_transactions']
2025-07-03 01:12:49,007 - INFO - orders - Using order model: user_orders for user 4 (user_type: live)
2025-07-03 01:12:49,007 - INFO - orders - Request to close order 7867765085 for user 4 (user_type: live) with price 0.52078. Frontend provided type: SELL, company: AUDCHF, status: CLOSED, frontend_status: CLOSED.
2025-07-03 01:12:49,010 - INFO - orders - User group: Standard, sending_orders setting: rock
2025-07-03 01:12:49,016 - INFO - orders - Live user 4 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-03 01:12:49,020 - INFO - orders - Existing entry commission for order 7867765085: 0.10000000
2025-07-03 01:12:49,020 - INFO - orders - Commission calculation for order 7867765085: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-03 01:12:49,021 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -0.300000000000000000000000 CHF to USD for PnL on Close (user_id: 4, position: 7867765085)
2025-07-03 01:12:49,021 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CHFUSD
2025-07-03 01:12:49,022 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-03 01:12:49,022 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CHFUSD, trying inverse
2025-07-03 01:12:49,022 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCHF
2025-07-03 01:12:49,023 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('0.7910400000'), 'o': Decimal('0.7910100000')}
2025-07-03 01:12:49,023 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 0.7910400000
2025-07-03 01:12:49,023 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -0.300000000000000000000000 CHF / 0.7910400000 = -0.3792475728155339805825242718 USD
2025-07-03 01:17:56,994 - INFO - orders - Application starting up - Orders logging initialized
2025-07-03 01:17:56,994 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-07-03 01:18:01,469 - INFO - orders - Order close request received - Order ID: 7867765085, User ID: 4, Close Price: 0.52081
2025-07-03 01:18:01,469 - INFO - orders - user_to_operate_on: <app.database.models.User object at 0x000002422EB5F4D0>, type: <class 'app.database.models.User'>, user_type: live, attrs: ['__abstract__', '__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__firstlineno__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__mapper__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__static_attributes__', '__str__', '__subclasshook__', '__table__', '__table_args__', '__tablename__', '__weakref__', '_sa_class_manager', '_sa_instance_state', '_sa_registry', 'account_number', 'address_proof', 'address_proof_image', 'bank_account_number', 'bank_branch_name', 'bank_holder_name', 'bank_ifsc_code', 'city', 'country', 'created_at', 'email', 'fund_manager', 'group_name', 'hashed_password', 'id', 'id_proof', 'id_proof_image', 'isActive', 'is_self_trading', 'is_service_account', 'leverage', 'margin', 'metadata', 'money_requests', 'name', 'net_profit', 'orders', 'otps', 'phone_number', 'pincode', 'referred_by_id', 'reffered_code', 'registry', 'rock_orders', 'security_answer', 'security_question', 'state', 'status', 'updated_at', 'user_favorites', 'user_type', 'wallet_balance', 'wallet_transactions']
2025-07-03 01:18:01,469 - INFO - orders - Using order model: user_orders for user 4 (user_type: live)
2025-07-03 01:18:01,469 - INFO - orders - Request to close order 7867765085 for user 4 (user_type: live) with price 0.52081. Frontend provided type: SELL, company: AUDCHF, status: CLOSED, frontend_status: CLOSED.
2025-07-03 01:18:01,478 - INFO - orders - User group: Standard, sending_orders setting: rock
2025-07-03 01:18:01,492 - INFO - orders - Live user 4 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-03 01:18:01,514 - INFO - orders - Existing entry commission for order 7867765085: 0.10000000
2025-07-03 01:18:01,514 - INFO - orders - Commission calculation for order 7867765085: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-03 01:18:01,521 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -0.330000000000000000000000 CHF to USD for PnL on Close (user_id: 4, position: 7867765085)
2025-07-03 01:18:01,522 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CHFUSD
2025-07-03 01:18:01,523 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-03 01:18:01,523 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CHFUSD, trying inverse
2025-07-03 01:18:01,523 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCHF
2025-07-03 01:18:01,525 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('0.7911000000'), 'o': Decimal('0.7910600000')}
2025-07-03 01:18:01,525 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 0.7911000000
2025-07-03 01:18:01,525 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -0.330000000000000000000000 CHF / 0.7911000000 = -0.4171406901782328403488813045 USD
2025-07-03 01:18:01,572 - INFO - orders - [DEBUG] DB commit completed for order 7867765085. Checking DB state...
2025-07-03 01:18:01,579 - INFO - orders - [DEBUG] After commit & refresh: order_id=7867765085, order_status=CLOSED, close_price=0.52081000, net_profit=-0.62000000, commission=0.20000000, close_id=9036195805, updated_at=2025-07-03 01:18:01
2025-07-03 01:18:01,579 - INFO - orders - AFTER COMMIT: User 4 wallet_balance=6633.41000000, margin=39.48000000
