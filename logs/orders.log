2025-06-29 23:34:49,028 - INFO - orders - Application starting up - Orders logging initialized
2025-06-29 23:34:49,029 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-06-29 23:36:35,729 - INFO - orders - Application starting up - Orders logging initialized
2025-06-29 23:36:35,729 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-06-29 23:37:13,861 - INFO - orders - Application starting up - Orders logging initialized
2025-06-29 23:37:13,861 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-06-29 23:37:40,132 - INFO - orders - Pending order placement request received - User ID: 10, Symbol: AUDCAD, Type: BUY_LIMIT, Quantity: 0.01
2025-06-29 23:37:40,148 - INFO - orders - Validating pending order price: Order type=BUY_LIMIT, Order price=0.89416, Current buy price=0.8941700000, Current sell price=0.8941100000
2025-06-29 23:37:40,178 - INFO - orders - Calculated contract_value for pending order: 1000.0000000000 (contract_size: 100000.00000000 * quantity: 0.01)
2025-06-29 23:37:40,182 - INFO - orders - [DEBUG] User data from cache: {'id': 10, 'email': 'cursordemo3@gmail.com', 'account_number': 'UPQKI', 'group_name': 'Group B', 'leverage': Decimal('100.00'), 'wallet_balance': Decimal('77.14000000'), 'margin': Decimal('6.55000000'), 'user_type': 'demo', 'first_name': None, 'last_name': None, 'country': None, 'phone_number': Decimal('18618025299')}
2025-06-29 23:37:40,182 - INFO - orders - [DEBUG] Group name: Group B
2025-06-29 23:37:40,183 - INFO - orders - [DEBUG] Group settings from cache: {'sending_orders': 'barclays'}
2025-06-29 23:37:40,183 - INFO - orders - [DEBUG] sending_orders value: barclays, type: <class 'str'>
2025-06-29 23:37:40,183 - INFO - orders - [DEBUG] sending_orders_normalized: barclays
2025-06-29 23:37:40,183 - INFO - orders - User 10 is_barclays_live_user: False (user_type: demo, sending_orders_normalized: barclays)
2025-06-29 23:37:40,199 - INFO - orders - [DEBUG][pending_order] Prepared order_data_for_internal_processing: {'order_id': '2844732039', 'order_company_name': 'AUDCAD', 'order_type': 'BUY_LIMIT', 'order_quantity': Decimal('0.01'), 'order_price': Decimal('0.89416'), 'user_type': 'demo', 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '9034148960', 'takeprofit_id': '6322663779', 'order_user_id': 10, 'order_status': 'PENDING', 'contract_value': Decimal('1000.0000000000'), 'margin': None, 'open_time': None}
2025-06-29 23:37:40,199 - INFO - orders - Placing PENDING order: BUY_LIMIT for user 10 at price 0.89416
2025-06-29 23:37:40,316 - INFO - orders - Order 2844732039 verified in database on attempt 1 before adding to Redis.
2025-06-29 23:37:40,321 - INFO - orders - Pending order 2844732039 added to Redis for non-Barclays user or demo user.
2025-06-29 23:37:40,330 - INFO - orders - User data cache updated for user 10 after placing pending order
2025-06-29 23:37:40,331 - INFO - orders - Starting update_user_static_orders for user 10, user_type demo
2025-06-29 23:37:40,331 - INFO - orders - Using order model: DemoUserOrder
2025-06-29 23:37:40,340 - INFO - orders - Fetched 1 open orders for user 10
2025-06-29 23:37:40,351 - INFO - orders - Fetched 2 pending orders for user 10
2025-06-29 23:37:40,353 - INFO - orders - Updated static orders cache for user 10 with 1 open orders and 2 pending orders
2025-06-29 23:37:44,980 - INFO - orders - [MARGIN_CALC] Starting margin calculation for AUDCAD BUY_LIMIT order, quantity: 0.01000000
2025-06-29 23:37:44,980 - INFO - orders - [MARGIN_CALC] No group_name in settings, fetching for user 10
2025-06-29 23:37:44,985 - INFO - orders - [MARGIN_CALC] Contract size for AUDCAD: 100000.00000000 (raw: 100000.00000000, type: <class 'decimal.Decimal'>)
2025-06-29 23:37:44,987 - INFO - orders - [MARGIN_CALC] Got BUY price for AUDCAD from cache: 0.8941000000
2025-06-29 23:37:44,987 - INFO - orders - [MARGIN_CALC] Contract value calculation for AUDCAD:
2025-06-29 23:37:44,987 - INFO - orders - [MARGIN_CALC] Contract value = contract_size * quantity = 100000.00000000 * 0.01000000 = 1000.0000000000000000
2025-06-29 23:37:44,992 - INFO - orders - [MARGIN_CALC] Using default leverage: 100
2025-06-29 23:37:44,992 - INFO - orders - [MARGIN_CALC] Margin calculation: (contract_value * price) / effective_leverage = (1000.0000000000000000 * 0.8941000000) / 100 = 8.9410000000000000000000000 (rounded to 8.94)
2025-06-29 23:37:44,993 - INFO - orders - [MARGIN_CALC] Commission settings for AUDCAD: type=0, value_type=0, rate=10.0000
2025-06-29 23:37:44,993 - INFO - orders - [MARGIN_CALC] Per lot commission: 0.01000000 * 10.0000 = 0.100000000000
2025-06-29 23:37:44,993 - INFO - orders - [MARGIN_CALC] Profit currency for AUDCAD: CAD
2025-06-29 23:37:44,993 - INFO - orders - [MARGIN_CALC] Converting margin from CAD to USD: 8.94 CAD
2025-06-29 23:37:44,993 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 8.94 CAD to USD for margin for AUDCAD BUY_LIMIT order (user_id: 10, position: )
2025-06-29 23:37:44,993 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-06-29 23:37:44,994 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-06-29 23:37:44,994 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-06-29 23:37:44,994 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-06-29 23:37:44,995 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3656800000'), 'o': Decimal('1.3656400000')}
2025-06-29 23:37:44,995 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3656800000
2025-06-29 23:37:44,995 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 8.94 CAD / 1.3656800000 = 6.546189444086462421650752739 USD
2025-06-29 23:37:44,995 - INFO - orders - [MARGIN_CALC] Margin after USD conversion: 8.94 CAD -> 6.546189444086462421650752739 USD
2025-06-29 23:37:44,995 - INFO - orders - [MARGIN_CALC] Final results for AUDCAD BUY_LIMIT: margin=6.546189444086462421650752739, price=0.8941000000, contract_value=1000.0000000000000000, commission=0.10
2025-06-30 03:09:16,857 - INFO - orders - Application starting up - Orders logging initialized
2025-06-30 03:09:16,857 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-06-30 03:12:07,494 - INFO - orders - Application starting up - Orders logging initialized
2025-06-30 03:12:07,494 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-06-30 03:15:03,091 - INFO - orders - Application starting up - Orders logging initialized
2025-06-30 03:15:03,092 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-06-30 03:16:56,436 - INFO - orders - Application starting up - Orders logging initialized
2025-06-30 03:16:56,436 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-06-30 03:18:12,141 - INFO - orders - Application starting up - Orders logging initialized
2025-06-30 03:18:12,141 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-06-30 03:18:55,596 - INFO - orders - Application starting up - Orders logging initialized
2025-06-30 03:18:55,596 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-06-30 03:20:50,992 - INFO - orders - Application starting up - Orders logging initialized
2025-06-30 03:20:50,992 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-06-30 03:22:33,771 - app.api.v1.endpoints.orders - INFO - [get_rejected_orders] user_type: demo
2025-06-30 03:25:17,640 - INFO - orders - Application starting up - Orders logging initialized
2025-06-30 03:25:17,641 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-06-30 03:25:28,781 - INFO - orders - Application starting up - Orders logging initialized
2025-06-30 03:25:28,781 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-06-30 03:27:48,388 - INFO - orders - Application starting up - Orders logging initialized
2025-06-30 03:27:48,388 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-06-30 03:41:34,147 - INFO - orders - Application starting up - Orders logging initialized
2025-06-30 03:41:34,147 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-06-30 03:41:57,951 - app.api.v1.endpoints.orders - INFO - [get_rejected_orders] user_type: demo
2025-06-30 03:42:03,594 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-30 03:42:03,596 - INFO - orders - [DEBUG] group_settings_cache: {'sending_orders': 'barclays'}
2025-06-30 03:42:03,596 - INFO - orders - [DEBUG] sending_orders_cache value: barclays (type: <class 'str'>)
2025-06-30 03:42:03,597 - INFO - orders - Order placement: user_id=1, is_barclays_live_user=False, user_type=demo, group_name=Group B, sending_orders_setting=barclays
2025-06-30 03:42:03,923 - INFO - orders - [ORDER_MARGIN_CALC] Calculating margin for AUDCAD BUY order, quantity: 0.01
2025-06-30 03:42:03,923 - INFO - orders - [ORDER_MARGIN_CALC] Contract size for AUDCAD: 100000.00000000 (raw: 100000.00000000, type: <class 'decimal.Decimal'>)
2025-06-30 03:42:03,924 - INFO - orders - [ORDER_MARGIN_CALC] Got BUY price for AUDCAD from cache: 0.8923700000
2025-06-30 03:42:03,924 - INFO - orders - [ORDER_MARGIN_CALC] Contract value calculation for AUDCAD:
2025-06-30 03:42:03,924 - INFO - orders - [ORDER_MARGIN_CALC] Contract value = quantity * contract_size = 0.01 * 100000.00000000 = 1000.0000000000
2025-06-30 03:42:03,924 - INFO - orders - [ORDER_MARGIN_CALC] Margin calculation: (contract_value * price) / leverage = (1000.0000000000 * 0.8923700000) / 100.00 = 8.923700000000000000 (rounded to 8.92)
2025-06-30 03:42:03,924 - INFO - orders - [ORDER_MARGIN_CALC] Commission settings for AUDCAD: type=0, value_type=0, rate=10.0000
2025-06-30 03:42:03,924 - INFO - orders - [ORDER_MARGIN_CALC] Per lot commission: 0.01 * 10.0000 = 0.100000
2025-06-30 03:42:03,925 - INFO - orders - [ORDER_MARGIN_CALC] Profit currency for AUDCAD: CAD
2025-06-30 03:42:03,925 - INFO - orders - [ORDER_MARGIN_CALC] Converting margin from CAD to USD: 8.92 CAD
2025-06-30 03:42:03,925 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 8.92 CAD to USD for margin for AUDCAD BUY order (user_id: 1, position: )
2025-06-30 03:42:03,925 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-06-30 03:42:03,926 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-06-30 03:42:03,926 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-06-30 03:42:03,926 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-06-30 03:42:03,927 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3674600000'), 'o': Decimal('1.3674200000')}
2025-06-30 03:42:03,927 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3674600000
2025-06-30 03:42:03,927 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 8.92 CAD / 1.3674600000 = 6.523042721542129203047986778 USD
2025-06-30 03:42:03,927 - INFO - orders - [ORDER_MARGIN_CALC] Margin after USD conversion: 8.92 CAD -> 6.523042721542129203047986778 USD
2025-06-30 03:42:03,927 - INFO - orders - [ORDER_MARGIN_CALC] Final results for AUDCAD BUY: margin=6.523042721542129203047986778, price=0.8923700000, contract_value=1000.0000000000, commission=0.10
2025-06-30 03:42:03,927 - app.services.order_processing - INFO - [COMMISSION_CALC] User 1 Symbol AUDCAD: Calculated commission=0.10
2025-06-30 03:42:03,932 - app.services.order_processing - INFO - [MARGIN_PROCESS] User 1 Symbol AUDCAD: MarginBefore=0.00, MarginAfter=6.52, AdditionalMargin=6.52
2025-06-30 03:42:03,932 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] User 1 Symbol AUDCAD
2025-06-30 03:42:03,932 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] Full margin for this order: 6.523042721542129203047986778
2025-06-30 03:42:03,932 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] Existing open orders count: 0
2025-06-30 03:42:03,933 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] Total margin before: 0.0
2025-06-30 03:42:03,933 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] Total margin after: 6.52
2025-06-30 03:42:03,933 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] Additional margin needed: 6.52
2025-06-30 03:42:03,936 - app.services.order_processing - INFO - [MARGIN_PROCESS] User 1: OriginalMarginDB=6.54000000, CalculatedNewMargin=13.06
2025-06-30 03:42:03,957 - INFO - orders - [PRE-CRUD] About to call create_order with: {'order_id': '5347599683', 'order_status': 'OPEN', 'order_user_id': 1, 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_price': Decimal('0.8923700000'), 'order_quantity': Decimal('0.01'), 'contract_value': Decimal('1000.0000000000'), 'margin': Decimal('6.523042721542129203047986778'), 'commission': Decimal('0.10'), 'stop_loss': None, 'take_profit': None, 'stoploss_id': None, 'takeprofit_id': None, 'status': 'OPEN'}
2025-06-30 03:42:03,957 - INFO - orders - [ENTER-CRUD] create_order called with: {'order_id': '5347599683', 'order_status': 'OPEN', 'order_user_id': 1, 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_price': Decimal('0.8923700000'), 'order_quantity': Decimal('0.01'), 'contract_value': Decimal('1000.0000000000'), 'margin': Decimal('6.523042721542129203047986778'), 'commission': Decimal('0.10'), 'stop_loss': None, 'take_profit': None, 'stoploss_id': None, 'takeprofit_id': None, 'status': 'OPEN'}
2025-06-30 03:42:03,958 - DEBUG - orders - [DEBUG][create_order] Received order_data: {'order_id': '5347599683', 'order_status': 'OPEN', 'order_user_id': 1, 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_price': Decimal('0.8923700000'), 'order_quantity': Decimal('0.01'), 'contract_value': Decimal('1000.0000000000'), 'margin': Decimal('6.523042721542129203047986778'), 'commission': Decimal('0.10'), 'stop_loss': None, 'take_profit': None, 'stoploss_id': None, 'takeprofit_id': None, 'status': 'OPEN'}
2025-06-30 03:42:03,958 - DEBUG - orders - [DEBUG][create_order] Created OrderActionHistory record for order_id: 5347599683
2025-06-30 03:42:03,980 - INFO - orders - [MARGIN_COMMIT_CHECK] User 1 margin in session BEFORE commit: 13.06000000
2025-06-30 03:42:03,990 - INFO - orders - User data cache updated for user 1 after placing order
2025-06-30 03:42:04,353 - INFO - orders - Portfolio cache updated and websocket event published for user 1 after placing order.
2025-06-30 03:42:04,371 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-06-30 03:42:04,371 - INFO - orders - Using order model: DemoUserOrder
2025-06-30 03:42:04,381 - INFO - orders - Fetched 2 open orders for user 1
2025-06-30 03:42:04,389 - INFO - orders - Fetched 0 pending orders for user 1
2025-06-30 03:42:04,394 - INFO - orders - Updated static orders cache for user 1 with 2 open orders and 0 pending orders
2025-06-30 03:42:10,002 - INFO - orders - Order close request received - Order ID: 6956282690, User ID: 1, Close Price: 0.5199
2025-06-30 03:42:10,002 - INFO - orders - user_to_operate_on: <app.database.models.DemoUser object at 0x000001A8D88EE9E0>, type: <class 'app.database.models.DemoUser'>, attrs: ['__abstract__', '__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__firstlineno__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__mapper__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__static_attributes__', '__str__', '__subclasshook__', '__table__', '__table_args__', '__tablename__', '__weakref__', '_sa_class_manager', '_sa_instance_state', '_sa_registry', 'account_number', 'city', 'country', 'created_at', 'demo_user_favorites', 'email', 'group_name', 'hashed_password', 'id', 'isActive', 'is_service_account', 'leverage', 'margin', 'metadata', 'name', 'net_profit', 'orders', 'otps', 'phone_number', 'pincode', 'referred_by_id', 'reffered_code', 'registry', 'security_answer', 'security_question', 'state', 'status', 'updated_at', 'user_type', 'wallet_balance', 'wallet_transactions']
2025-06-30 03:42:10,002 - INFO - orders - Using order model: demo_user_orders for user 1 (DemoUser)
2025-06-30 03:42:10,003 - INFO - orders - Request to close order 6956282690 for user 1 (DemoUser) with price 0.5199. Frontend provided type: BUY, company: AUDCHF, status: CLOSED, frontend_status: CLOSED.
2025-06-30 03:42:10,013 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-06-30 03:42:10,026 - INFO - orders - Existing entry commission for order 6956282690: 0.10000000
2025-06-30 03:42:10,026 - INFO - orders - Commission calculation for order 6956282690: entry=0.10000000, exit=0.100000000000, total=0.20
2025-06-30 03:42:10,026 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -0.800000000000000000000000 CHF to USD for PnL on Close (user_id: 1, position: 6956282690)
2025-06-30 03:42:10,026 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CHFUSD
2025-06-30 03:42:10,027 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-06-30 03:42:10,027 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CHFUSD, trying inverse
2025-06-30 03:42:10,027 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCHF
2025-06-30 03:42:10,028 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('0.7970600000'), 'o': Decimal('0.7970100000')}
2025-06-30 03:42:10,028 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 0.7970600000
2025-06-30 03:42:10,028 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -0.800000000000000000000000 CHF / 0.7970600000 = -1.003688555441246581185858028 USD
2025-06-30 03:42:10,059 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=913.28000000, margin=6.52
2025-06-30 03:42:10,060 - INFO - orders - Setting user data cache for user 1 with wallet_balance=913.28000000, margin=6.52
2025-06-30 03:42:10,062 - INFO - orders - User data cache updated for user 1
2025-06-30 03:42:10,062 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-06-30 03:42:10,062 - INFO - orders - Using order model: DemoUserOrder
2025-06-30 03:42:10,064 - INFO - orders - Fetched 1 open orders for user 1
2025-06-30 03:42:10,071 - INFO - orders - Fetched 0 pending orders for user 1
2025-06-30 03:42:10,073 - INFO - orders - Updated static orders cache for user 1 with 1 open orders and 0 pending orders
2025-06-30 03:42:10,073 - INFO - orders - Publishing order update for user 1
2025-06-30 03:42:10,077 - INFO - orders - Publishing user data update for user 1
2025-06-30 03:42:10,078 - INFO - orders - Publishing market data trigger
2025-06-30 03:42:10,607 - INFO - orders - Order close request received - Order ID: 5347599683, User ID: 1, Close Price: 0.89233
2025-06-30 03:42:10,607 - INFO - orders - user_to_operate_on: <app.database.models.DemoUser object at 0x000001A8D88EE3F0>, type: <class 'app.database.models.DemoUser'>, attrs: ['__abstract__', '__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__firstlineno__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__mapper__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__static_attributes__', '__str__', '__subclasshook__', '__table__', '__table_args__', '__tablename__', '__weakref__', '_sa_class_manager', '_sa_instance_state', '_sa_registry', 'account_number', 'city', 'country', 'created_at', 'demo_user_favorites', 'email', 'group_name', 'hashed_password', 'id', 'isActive', 'is_service_account', 'leverage', 'margin', 'metadata', 'name', 'net_profit', 'orders', 'otps', 'phone_number', 'pincode', 'referred_by_id', 'reffered_code', 'registry', 'security_answer', 'security_question', 'state', 'status', 'updated_at', 'user_type', 'wallet_balance', 'wallet_transactions']
2025-06-30 03:42:10,607 - INFO - orders - Using order model: demo_user_orders for user 1 (DemoUser)
2025-06-30 03:42:10,607 - INFO - orders - Request to close order 5347599683 for user 1 (DemoUser) with price 0.89233. Frontend provided type: BUY, company: AUDCAD, status: CLOSED, frontend_status: CLOSED.
2025-06-30 03:42:10,625 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-06-30 03:42:10,653 - INFO - orders - Existing entry commission for order 5347599683: 0.10000000
2025-06-30 03:42:10,653 - INFO - orders - Commission calculation for order 5347599683: entry=0.10000000, exit=0.100000000000, total=0.20
2025-06-30 03:42:10,654 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -0.040000000000000000000000 CAD to USD for PnL on Close (user_id: 1, position: 5347599683)
2025-06-30 03:42:10,654 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-06-30 03:42:10,655 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-06-30 03:42:10,655 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-06-30 03:42:10,656 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-06-30 03:42:10,659 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3674500000'), 'o': Decimal('1.3674100000')}
2025-06-30 03:42:10,659 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3674500000
2025-06-30 03:42:10,659 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -0.040000000000000000000000 CAD / 1.3674500000 = -0.02925152656404256097115068193 USD
2025-06-30 03:42:10,692 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=913.05000000, margin=0
2025-06-30 03:42:10,693 - INFO - orders - Setting user data cache for user 1 with wallet_balance=913.05000000, margin=0
2025-06-30 03:42:10,695 - INFO - orders - User data cache updated for user 1
2025-06-30 03:42:10,696 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-06-30 03:42:10,696 - INFO - orders - Using order model: DemoUserOrder
2025-06-30 03:42:10,703 - INFO - orders - Fetched 0 open orders for user 1
2025-06-30 03:42:10,709 - INFO - orders - Fetched 0 pending orders for user 1
2025-06-30 03:42:10,712 - INFO - orders - Updated static orders cache for user 1 with 0 open orders and 0 pending orders
2025-06-30 03:42:10,712 - INFO - orders - Publishing order update for user 1
2025-06-30 03:42:10,716 - INFO - orders - Publishing user data update for user 1
2025-06-30 03:42:10,718 - INFO - orders - Publishing market data trigger
2025-06-30 03:43:17,085 - INFO - orders - Application starting up - Orders logging initialized
2025-06-30 03:43:17,085 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
