2025-06-27 04:47:38,541 - INFO - orders - Application starting up - Orders logging initialized
2025-06-27 04:47:38,541 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-06-27 04:47:55,446 - app.api.v1.endpoints.orders - INFO - [get_rejected_orders] user_type: demo
2025-06-27 04:48:39,251 - INFO - orders - [PENDING_ORDER_EXECUTION][PORTFOLIO_UPDATE] user_id=9, user_type=live, group_name=Group B, free_margin=9543.008928808299232896597465, margin_level=147141.7400432711746209028885, balance=10000.00000000, equity=9549.498928808299232896597465
2025-06-27 04:48:40,071 - INFO - orders - [PENDING_ORDER_EXECUTION][PORTFOLIO_UPDATE] user_id=10, user_type=demo, group_name=Group B, free_margin=1546.749918463856636286375758, margin_level=11934.35285741282812766928660, balance=1559.93932766, equity=1559.819918463856636286375758
2025-06-27 04:49:40,115 - INFO - orders - [PENDING_ORDER_EXECUTION][PORTFOLIO_UPDATE] user_id=9, user_type=live, group_name=Group B, free_margin=9542.967666078556502371210130, margin_level=147141.1042539068798516365197, balance=10000.00000000, equity=9549.457666078556502371210130
2025-06-27 04:49:41,350 - INFO - orders - [PENDING_ORDER_EXECUTION][PORTFOLIO_UPDATE] user_id=10, user_type=demo, group_name=Group B, free_margin=1546.823181703797117800912867, margin_level=11934.91340247740717521738995, balance=1559.93932766, equity=1559.893181703797117800912867
2025-06-27 05:03:29,174 - INFO - orders - Application starting up - Orders logging initialized
2025-06-27 05:03:29,174 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-06-27 05:04:14,818 - INFO - orders - Application starting up - Orders logging initialized
2025-06-27 05:04:14,818 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-06-27 05:04:17,062 - app.api.v1.endpoints.orders - INFO - [get_rejected_orders] user_type: demo
2025-06-27 05:04:30,310 - INFO - orders - [PENDING_ORDER_EXECUTION][PORTFOLIO_UPDATE] user_id=9, user_type=live, group_name=Group B, free_margin=9542.936442879127203573260600, margin_level=147140.6231568432542923460801, balance=10000.00000000, equity=9549.426442879127203573260600
2025-06-27 05:04:32,419 - INFO - orders - [PENDING_ORDER_EXECUTION][PORTFOLIO_UPDATE] user_id=10, user_type=demo, group_name=Group B, free_margin=1546.705946965697963966603193, margin_level=11934.01642666945649553636720, balance=1559.93932766, equity=1559.775946965697963966603193
2025-06-27 05:04:44,799 - INFO - orders - Application starting up - Orders logging initialized
2025-06-27 05:04:44,800 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-06-27 05:05:15,670 - INFO - orders - [PENDING_ORDER_EXECUTION][PORTFOLIO_UPDATE] user_id=9, user_type=live, group_name=Group B, free_margin=9542.870037791097818878029858, margin_level=147139.5999659645272554395972, balance=10000.00000000, equity=9549.360037791097818878029858
2025-06-27 05:05:16,348 - INFO - orders - [PENDING_ORDER_EXECUTION][PORTFOLIO_UPDATE] user_id=10, user_type=demo, group_name=Group B, free_margin=1546.705956354919600014651478, margin_level=11934.01649850741851579687435, balance=1559.93932766, equity=1559.775956354919600014651478
2025-06-27 05:05:45,368 - INFO - orders - [PENDING_ORDER_EXECUTION][PORTFOLIO_UPDATE] user_id=9, user_type=live, group_name=Group B, free_margin=9542.945119442393603043309599, margin_level=147140.7568481108413411912111, balance=10000.00000000, equity=9549.435119442393603043309599
2025-06-27 05:05:45,746 - INFO - orders - [PENDING_ORDER_EXECUTION][PORTFOLIO_UPDATE] user_id=10, user_type=demo, group_name=Group B, free_margin=1546.647351569985935302390999, margin_level=11933.56810688589085923788064, balance=1559.93932766, equity=1559.717351569985935302390999
2025-06-27 05:06:04,118 - app.api.v1.endpoints.orders - INFO - [get_rejected_orders] user_type: demo
2025-06-27 05:06:06,466 - app.api.v1.endpoints.orders - INFO - [get_rejected_orders] user_type: demo
2025-06-27 05:06:44,213 - app.api.v1.endpoints.orders - INFO - [get_rejected_orders] user_type: demo
2025-06-27 05:06:45,958 - INFO - orders - [PENDING_ORDER_EXECUTION][PORTFOLIO_UPDATE] user_id=9, user_type=live, group_name=Group B, free_margin=9542.787385645453976597209186, margin_level=147138.3264352150073435625452, balance=10000.00000000, equity=9549.277385645453976597209186
2025-06-27 05:06:46,859 - INFO - orders - [PENDING_ORDER_EXECUTION][PORTFOLIO_UPDATE] user_id=10, user_type=demo, group_name=Group B, free_margin=1546.705954208387333074505725, margin_level=11934.01648208406528748665436, balance=1559.93932766, equity=1559.775954208387333074505725
2025-06-27 05:07:12,591 - INFO - orders - Add stoploss request received - Order ID: 4068750376, User ID: 10
2025-06-27 05:07:12,605 - INFO - orders - Generated stoploss_id: 2996123137 for order 4068750376
2025-06-27 05:07:12,608 - INFO - orders - User 10 is_barclays_live_user: False
2025-06-27 05:07:12,608 - INFO - orders - Non-Barclays user. Adding stoploss to order 4068750376 immediately
2025-06-27 05:07:12,702 - INFO - orders - Starting update_user_static_orders for user 10, user_type demo
2025-06-27 05:07:12,702 - INFO - orders - Using order model: DemoUserOrder
2025-06-27 05:07:12,710 - INFO - orders - Fetched 2 open orders for user 10
2025-06-27 05:07:12,718 - INFO - orders - Fetched 0 pending orders for user 10
2025-06-27 05:07:12,719 - INFO - orders - Updated static orders cache for user 10 with 2 open orders and 0 pending orders
2025-06-27 05:07:23,357 - INFO - orders - Add takeprofit request received - Order ID: 4068750376, User ID: 10
2025-06-27 05:07:23,373 - INFO - orders - Generated takeprofit_id: 3656539613 for order 4068750376
2025-06-27 05:07:23,378 - INFO - orders - User 10 is_barclays_live_user: False
2025-06-27 05:07:23,378 - INFO - orders - Non-Barclays user. Adding takeprofit to order 4068750376 immediately
2025-06-27 05:07:23,407 - INFO - orders - Starting update_user_static_orders for user 10, user_type demo
2025-06-27 05:07:23,407 - INFO - orders - Using order model: DemoUserOrder
2025-06-27 05:07:23,413 - INFO - orders - Fetched 2 open orders for user 10
2025-06-27 05:07:23,419 - INFO - orders - Fetched 0 pending orders for user 10
2025-06-27 05:07:23,421 - INFO - orders - Updated static orders cache for user 10 with 2 open orders and 0 pending orders
2025-06-27 05:07:24,831 - INFO - orders - [ORDER_CLOSE] Closing demo order 4068750376 at price 0.8922500000 due to STOP_LOSS
2025-06-27 05:07:24,855 - app.services.order_processing - DEBUG - [MARGIN_TOTAL_CONTRIB_ENTRY] User 10, Symbol AUDCAD, Positions count: 2
2025-06-27 05:07:24,855 - app.services.order_processing - DEBUG - [MARGIN_TOTAL_CONTRIB_POS_DETAIL] User 10, Symbol AUDCAD, Pos 1 (ID: 387): Type=SELL, Qty=0.01000000, StoredMargin=6.53460704
2025-06-27 05:07:24,855 - app.services.order_processing - DEBUG - [MARGIN_TOTAL_CONTRIB_POS_DETAIL] User 10, Symbol AUDCAD, Pos 1: MarginPerLot=653.460704
2025-06-27 05:07:24,855 - app.services.order_processing - DEBUG - [MARGIN_TOTAL_CONTRIB_POS_DETAIL] User 10, Symbol AUDCAD, Pos 2 (ID: 389): Type=SELL, Qty=0.01000000, StoredMargin=6.53470279
2025-06-27 05:07:24,855 - app.services.order_processing - DEBUG - [MARGIN_TOTAL_CONTRIB_POS_DETAIL] User 10, Symbol AUDCAD, Pos 2: MarginPerLot=653.470279
2025-06-27 05:07:24,855 - app.services.order_processing - DEBUG - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDCAD: TotalBuyQty=0, TotalSellQty=0.02000000, NetQty=0.02000000
2025-06-27 05:07:24,855 - app.services.order_processing - DEBUG - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDCAD: AllMarginsPerLot=[Decimal('653.460704'), Decimal('653.470279')], HighestMarginPerLot=653.470279
2025-06-27 05:07:24,855 - app.services.order_processing - DEBUG - [MARGIN_TOTAL_CONTRIB_EXIT] User 10, Symbol AUDCAD: CalculatedTotalMargin=13.07, ContributingOrders=2 (based on individual stored margins)
2025-06-27 05:07:24,856 - app.services.order_processing - DEBUG - [MARGIN_TOTAL_CONTRIB_ENTRY] User 10, Symbol AUDCAD, Positions count: 1
2025-06-27 05:07:24,856 - app.services.order_processing - DEBUG - [MARGIN_TOTAL_CONTRIB_POS_DETAIL] User 10, Symbol AUDCAD, Pos 1 (ID: 389): Type=SELL, Qty=0.01000000, StoredMargin=6.53470279
2025-06-27 05:07:24,856 - app.services.order_processing - DEBUG - [MARGIN_TOTAL_CONTRIB_POS_DETAIL] User 10, Symbol AUDCAD, Pos 1: MarginPerLot=653.470279
2025-06-27 05:07:24,856 - app.services.order_processing - DEBUG - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDCAD: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000
2025-06-27 05:07:24,857 - app.services.order_processing - DEBUG - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDCAD: AllMarginsPerLot=[Decimal('653.470279')], HighestMarginPerLot=653.470279
2025-06-27 05:07:24,857 - app.services.order_processing - DEBUG - [MARGIN_TOTAL_CONTRIB_EXIT] User 10, Symbol AUDCAD: CalculatedTotalMargin=6.53, ContributingOrders=1 (based on individual stored margins)
2025-06-27 05:07:24,885 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -0.01000000000000000000000000 CAD to USD for PnL on Close (user_id: 10, position: 4068750376)
2025-06-27 05:07:24,886 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-06-27 05:07:24,887 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-06-27 05:07:24,887 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-06-27 05:07:24,887 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-06-27 05:07:24,890 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3651900000'), 'o': Decimal('1.3651800000')}
2025-06-27 05:07:24,890 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3651900000
2025-06-27 05:07:24,890 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -0.01000000000000000000000000 CAD / 1.3651900000 = -0.007324987730645551168701792424 USD
2025-06-27 05:07:25,065 - INFO - orders - Starting update_user_static_orders for user 10, user_type demo
2025-06-27 05:07:25,065 - INFO - orders - Using order model: DemoUserOrder
2025-06-27 05:07:25,075 - INFO - orders - Fetched 1 open orders for user 10
2025-06-27 05:07:25,089 - INFO - orders - Fetched 0 pending orders for user 10
2025-06-27 05:07:25,094 - INFO - orders - Updated static orders cache for user 10 with 1 open orders and 0 pending orders
2025-06-27 05:07:25,105 - INFO - orders - [PENDING_ORDER_EXECUTION_DEBUG] Published order execution notification for order 4068750376 to channel user:10:notifications
2025-06-27 05:07:25,112 - INFO - orders - [ORDER_CLOSE] Removed order 4068750376 from Redis pending orders (type: BUY_LIMIT)
2025-06-27 05:07:25,119 - INFO - orders - [ORDER_CLOSE] Removed order 4068750376 from Redis pending orders (type: SELL_LIMIT)
2025-06-27 05:07:25,123 - INFO - orders - [ORDER_CLOSE] Removed order 4068750376 from Redis pending orders (type: BUY_STOP)
2025-06-27 05:07:25,128 - INFO - orders - [ORDER_CLOSE] Removed order 4068750376 from Redis pending orders (type: SELL_STOP)
2025-06-27 05:07:25,128 - INFO - orders - [ORDER_CLOSE] Successfully closed order 4068750376 due to STOP_LOSS with robust margin/wallet logic.
2025-06-27 05:07:25,128 - INFO - orders - [ORDER_CLOSE] Order details - Net Profit: -0.21000000, Commission: 0.20, Swap: 0E-8
2025-06-27 05:07:25,128 - INFO - orders - [ORDER_CLOSE] User margin updated: 13.07000000 -> 6.53000000
2025-06-27 05:07:25,128 - INFO - orders - [ORDER_CLOSE] User wallet updated: 1559.93932766 -> 1559.72932766
