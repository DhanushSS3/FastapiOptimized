2025-07-02 05:00:09,157 - INFO - orders - Application starting up - Orders logging initialized
2025-07-02 05:00:09,157 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-07-02 05:00:16,845 - INFO - orders - Order placement request received - User ID: 4, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-07-02 05:00:16,846 - INFO - orders - [PERF] user_data_cache: 0.0015s
2025-07-02 05:00:16,848 - INFO - orders - [PERF] group_settings_cache+db_user: 0.0014s
2025-07-02 05:00:16,848 - DEBUG - orders - [BARCLAYS DETECTION] user_type=live, sending_orders_normalized=barclays, is_barclays_live_user=True
2025-07-02 05:00:16,848 - DEBUG - orders - [BARCLAYS] Setting order_status=PROCESSING for Barclays user 4
2025-07-02 05:00:17,217 - INFO - orders - [MARGIN_CALC] Starting margin calculation for AUDCAD BUY order, quantity: 0.01
2025-07-02 05:00:17,218 - INFO - orders - [MARGIN_CALC] No group_name in settings, fetching for user 4
2025-07-02 05:00:17,220 - INFO - orders - [MARGIN_CALC] Got group_name from database: Standard
2025-07-02 05:00:17,220 - INFO - orders - [MARGIN_CALC] Contract size for AUDCAD: 100000.00000000 (raw: 100000.00000000, type: <class 'decimal.Decimal'>)
2025-07-02 05:00:17,221 - INFO - orders - [MARGIN_CALC] Got BUY price for AUDCAD from cache: 0.8943700000
2025-07-02 05:00:17,221 - INFO - orders - [MARGIN_CALC] Symbol type from group settings: 1
2025-07-02 05:00:17,221 - INFO - orders - [MARGIN_CALC] Standard contract value calculation: contract_size * quantity = 100000.00000000 * 0.01 = 1000.0000000000
2025-07-02 05:00:17,221 - INFO - orders - [MARGIN_CALC] Standard Margin calc: (contract_value * price) / effective_leverage = (1000.0000000000 * 0.8943700000) / 100.00 = 8.943700000000000000
2025-07-02 05:00:17,221 - INFO - orders - [MARGIN_CALC] Commission settings for AUDCAD: type=2, value_type=0, rate=10.0000
2025-07-02 05:00:17,221 - INFO - orders - [MARGIN_CALC] Profit currency for AUDCAD: CAD
2025-07-02 05:00:17,221 - INFO - orders - [MARGIN_CALC] Converting margin from CAD to USD: 8.94 CAD
2025-07-02 05:00:17,221 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 8.94 CAD to USD for margin for AUDCAD BUY order (user_id: 4, position: )
2025-07-02 05:00:17,221 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-07-02 05:00:17,221 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-02 05:00:17,221 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-07-02 05:00:17,221 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-07-02 05:00:17,222 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3648900000'), 'o': Decimal('1.3648600000')}
2025-07-02 05:00:17,222 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3648900000
2025-07-02 05:00:17,222 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 8.94 CAD / 1.3648900000 = 6.549978386536643978635640967 USD
2025-07-02 05:00:17,222 - INFO - orders - [MARGIN_CALC] Margin after USD conversion: 8.94 CAD -> 6.549978386536643978635640967 USD
2025-07-02 05:00:17,222 - INFO - orders - [MARGIN_CALC] Final results for AUDCAD BUY: margin=6.549978386536643978635640967, price=0.8943700000, contract_value=1000.0000000000, commission=0.00
2025-07-02 05:00:17,222 - app.services.order_processing - INFO - [COMMISSION_CALC] User 4 Symbol AUDCAD: Calculated commission=0.00
2025-07-02 05:00:17,224 - app.services.order_processing - INFO - [MARGIN_PROCESS] User 4 Symbol AUDCAD: MarginBefore=13.18, MarginAfter=19.76, AdditionalMargin=6.58
2025-07-02 05:00:17,224 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] User 4 Symbol AUDCAD
2025-07-02 05:00:17,224 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] Full margin for this order: 6.549978386536643978635640967
2025-07-02 05:00:17,224 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] Existing open orders count: 2
2025-07-02 05:00:17,224 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] Total margin before: 13.18
2025-07-02 05:00:17,224 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] Total margin after: 19.76
2025-07-02 05:00:17,224 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] Additional margin needed: 6.58
2025-07-02 05:00:17,226 - INFO - orders - [PERF] process_new_order: 0.3784s
2025-07-02 05:00:17,226 - INFO - orders - [ENTER-CRUD] create_order called with: {'order_id': '6285484226', 'order_status': 'PROCESSING', 'order_user_id': 4, 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_price': Decimal('0.8943700000'), 'order_quantity': Decimal('0.01'), 'contract_value': Decimal('1000.0000000000'), 'margin': Decimal('6.549978386536643978635640967'), 'commission': Decimal('0.00'), 'stop_loss': None, 'take_profit': None, 'stoploss_id': None, 'takeprofit_id': None, 'status': 'OPEN'}
2025-07-02 05:00:17,227 - DEBUG - orders - [DEBUG][create_order] Received order_data: {'order_id': '6285484226', 'order_status': 'PROCESSING', 'order_user_id': 4, 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_price': Decimal('0.8943700000'), 'order_quantity': Decimal('0.01'), 'contract_value': Decimal('1000.0000000000'), 'margin': Decimal('6.549978386536643978635640967'), 'commission': Decimal('0.00'), 'stop_loss': None, 'take_profit': None, 'stoploss_id': None, 'takeprofit_id': None, 'status': 'OPEN'}
2025-07-02 05:00:17,227 - DEBUG - orders - [DEBUG][create_order] Created OrderActionHistory record for order_id: 6285484226
2025-07-02 05:00:17,241 - INFO - orders - [PERF] crud_order.create_order: 0.0146s
2025-07-02 05:00:17,244 - INFO - orders - [PERF] db.commit+refresh: 0.0028s
2025-07-02 05:00:17,244 - INFO - orders - [PERF] TOTAL place_order: 0.4000s
2025-07-02 05:00:17,630 - DEBUG - orders - [BARCLAYS] Preparing to send order to Firebase for user_id=4, order_id=6285484226, order_status=PROCESSING
2025-07-02 05:00:17,936 - DEBUG - orders - [BARCLAYS] free_margin=6615.25000000, order_margin=6.54997839 for user_id=4
2025-07-02 05:00:17,936 - DEBUG - orders - [BARCLAYS] Calling send_order_to_firebase with data: {'order_id': '6285484226', 'order_user_id': 4, 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_status': 'PROCESSING', 'order_price': Decimal('0.89437000'), 'order_quantity': Decimal('0.01000000'), 'contract_value': Decimal('1000.00000000'), 'margin': Decimal('6.54997839'), 'stop_loss': None, 'take_profit': None}
2025-07-02 05:00:23,071 - INFO - orders - Order placement request received - User ID: 4, Symbol: AUDCAD, Type: SELL, Quantity: 0.01
2025-07-02 05:00:23,071 - INFO - orders - [PERF] user_data_cache: 0.0004s
2025-07-02 05:00:23,072 - INFO - orders - [PERF] group_settings_cache+db_user: 0.0004s
2025-07-02 05:00:23,072 - DEBUG - orders - [BARCLAYS DETECTION] user_type=live, sending_orders_normalized=barclays, is_barclays_live_user=True
2025-07-02 05:00:23,072 - DEBUG - orders - [BARCLAYS] Setting order_status=PROCESSING for Barclays user 4
2025-07-02 05:00:23,465 - INFO - orders - [MARGIN_CALC] Starting margin calculation for AUDCAD SELL order, quantity: 0.01
2025-07-02 05:00:23,465 - INFO - orders - [MARGIN_CALC] No group_name in settings, fetching for user 4
2025-07-02 05:00:23,469 - INFO - orders - [MARGIN_CALC] Got group_name from database: Standard
2025-07-02 05:00:23,469 - INFO - orders - [MARGIN_CALC] Contract size for AUDCAD: 100000.00000000 (raw: 100000.00000000, type: <class 'decimal.Decimal'>)
2025-07-02 05:00:23,470 - INFO - orders - [MARGIN_CALC] Got SELL price for AUDCAD from cache: 0.8941000000
2025-07-02 05:00:23,470 - INFO - orders - [MARGIN_CALC] Symbol type from group settings: 1
2025-07-02 05:00:23,471 - INFO - orders - [MARGIN_CALC] Standard contract value calculation: contract_size * quantity = 100000.00000000 * 0.01 = 1000.0000000000
2025-07-02 05:00:23,471 - INFO - orders - [MARGIN_CALC] Standard Margin calc: (contract_value * price) / effective_leverage = (1000.0000000000 * 0.8941000000) / 100.00 = 8.941000000000000000
2025-07-02 05:00:23,471 - INFO - orders - [MARGIN_CALC] Commission settings for AUDCAD: type=2, value_type=0, rate=10.0000
2025-07-02 05:00:23,471 - INFO - orders - [MARGIN_CALC] Profit currency for AUDCAD: CAD
2025-07-02 05:00:23,471 - INFO - orders - [MARGIN_CALC] Converting margin from CAD to USD: 8.94 CAD
2025-07-02 05:00:23,471 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 8.94 CAD to USD for margin for AUDCAD SELL order (user_id: 4, position: )
2025-07-02 05:00:23,471 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-07-02 05:00:23,473 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-02 05:00:23,473 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-07-02 05:00:23,473 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-07-02 05:00:23,473 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3647400000'), 'o': Decimal('1.3647300000')}
2025-07-02 05:00:23,473 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3647400000
2025-07-02 05:00:23,474 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 8.94 CAD / 1.3647400000 = 6.550698301507979541890763076 USD
2025-07-02 05:00:23,474 - INFO - orders - [MARGIN_CALC] Margin after USD conversion: 8.94 CAD -> 6.550698301507979541890763076 USD
2025-07-02 05:00:23,474 - INFO - orders - [MARGIN_CALC] Final results for AUDCAD SELL: margin=6.550698301507979541890763076, price=0.8941000000, contract_value=1000.0000000000, commission=0.00
2025-07-02 05:00:23,474 - app.services.order_processing - INFO - [COMMISSION_CALC] User 4 Symbol AUDCAD: Calculated commission=0.00
2025-07-02 05:00:23,479 - app.services.order_processing - INFO - [MARGIN_PROCESS] User 4 Symbol AUDCAD: MarginBefore=13.18, MarginAfter=13.18, AdditionalMargin=0.00
2025-07-02 05:00:23,479 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] User 4 Symbol AUDCAD
2025-07-02 05:00:23,479 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] Full margin for this order: 6.550698301507979541890763076
2025-07-02 05:00:23,479 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] Existing open orders count: 2
2025-07-02 05:00:23,479 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] Total margin before: 13.18
2025-07-02 05:00:23,479 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] Total margin after: 13.18
2025-07-02 05:00:23,479 - app.services.order_processing - INFO - [MARGIN_PROCESS_DEBUG] Additional margin needed: 0.0
2025-07-02 05:00:23,482 - INFO - orders - [PERF] process_new_order: 0.4107s
2025-07-02 05:00:23,483 - INFO - orders - [ENTER-CRUD] create_order called with: {'order_id': '4888211676', 'order_status': 'PROCESSING', 'order_user_id': 4, 'order_company_name': 'AUDCAD', 'order_type': 'SELL', 'order_price': Decimal('0.8941000000'), 'order_quantity': Decimal('0.01'), 'contract_value': Decimal('1000.0000000000'), 'margin': Decimal('6.550698301507979541890763076'), 'commission': Decimal('0.00'), 'stop_loss': None, 'take_profit': None, 'stoploss_id': None, 'takeprofit_id': None, 'status': 'OPEN'}
2025-07-02 05:00:23,483 - DEBUG - orders - [DEBUG][create_order] Received order_data: {'order_id': '4888211676', 'order_status': 'PROCESSING', 'order_user_id': 4, 'order_company_name': 'AUDCAD', 'order_type': 'SELL', 'order_price': Decimal('0.8941000000'), 'order_quantity': Decimal('0.01'), 'contract_value': Decimal('1000.0000000000'), 'margin': Decimal('6.550698301507979541890763076'), 'commission': Decimal('0.00'), 'stop_loss': None, 'take_profit': None, 'stoploss_id': None, 'takeprofit_id': None, 'status': 'OPEN'}
2025-07-02 05:00:23,483 - DEBUG - orders - [DEBUG][create_order] Created OrderActionHistory record for order_id: 4888211676
2025-07-02 05:00:23,497 - INFO - orders - [PERF] crud_order.create_order: 0.0145s
2025-07-02 05:00:23,501 - INFO - orders - [PERF] db.commit+refresh: 0.0041s
2025-07-02 05:00:23,501 - INFO - orders - [PERF] TOTAL place_order: 0.4308s
2025-07-02 05:00:23,882 - DEBUG - orders - [BARCLAYS] Preparing to send order to Firebase for user_id=4, order_id=4888211676, order_status=PROCESSING
2025-07-02 05:00:24,285 - DEBUG - orders - [BARCLAYS] free_margin=6615.25000000, order_margin=6.55069830 for user_id=4
2025-07-02 05:00:24,286 - DEBUG - orders - [BARCLAYS] Calling send_order_to_firebase with data: {'order_id': '4888211676', 'order_user_id': 4, 'order_company_name': 'AUDCAD', 'order_type': 'SELL', 'order_status': 'PROCESSING', 'order_price': Decimal('0.89410000'), 'order_quantity': Decimal('0.01000000'), 'contract_value': Decimal('1000.00000000'), 'margin': Decimal('6.55069830'), 'stop_loss': None, 'take_profit': None}
